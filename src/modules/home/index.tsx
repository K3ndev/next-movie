import { useEffect, useRef } from 'react';
import Head from 'next/head';
import { useInfiniteQuery } from '@tanstack/react-query';
// eslint-disable-next-line import/no-extraneous-dependencies
import { useIntersection } from '@mantine/hooks';
import { Header, Footer } from '../../shared/components/index';

// import Image from 'next/image';
// import { Inter } from 'next/font/google';

// const inter = Inter({ subsets: ['latin'] });

export default function Home(props: any) {
  // for seo? haha lol
  // probably jusr render this then render the 2nd from react-query
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const { data } = props;

  const fetchPokemon = async ({
    pageParam = 'https://pokeapi.co/api/v2/pokemon?offset=0&limit=20',
  }) => {
    const res = await fetch(pageParam);
    const { results, next } = await res.json();
    return { response: results, nextPage: next };
  };

  const { data: DATA, fetchNextPage } = useInfiniteQuery(
    ['pokemon'],
    fetchPokemon,
    {
      getNextPageParam: (lastPage) => {
        return lastPage.nextPage;
      },
    }
  );

  const { ref, entry } = useIntersection();
  const delayRef = useRef<NodeJS.Timeout | null>(null);

  useEffect(() => {
    if (entry?.isIntersecting) {
      delayRef.current = setTimeout(fetchNextPage, 1000);
    }
    return () => {
      clearTimeout(delayRef.current!);
    };
  }, [entry?.isIntersecting, fetchNextPage]);

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
        <title>Next Pokemon | Home page </title>
      </Head>
      <Header />
      <main className="bg-[#D9D9D9]">
        <section className="mx-auto grid max-w-7xl grid-cols-4 gap-2">
          {DATA?.pages.map((group) =>
            group.response.map((pokemon: any) => (
              <div key={pokemon.name} className=" ">
                <div className="h-56 bg-slate-600 p-3">{pokemon.name}</div>
              </div>
            ))
          )}
        </section>
        {DATA && (
          <section className="mx-auto max-w-7xl">
            <div className="flex justify-center bg-red-300 ">
              <div ref={ref} className="text-red-900">
                Fetching
              </div>
            </div>
          </section>
        )}
      </main>
      <Footer />
    </>
  );
}

// https://eya-recipes.netlify.app/
